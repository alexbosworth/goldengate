const {test} = require('tap');

const {decodeLightningLabsRecovery} = require('./../../lightninglabs');

const tests = [
  {
    args: {
      recovery: 'a86c657865637574696f6e5f69647840333335366461636361646464333930393365326561313161323565376234363731396565383663356537363537373637386537333538636538653535613565346b707269766174655f6b65797840666332643330633736343139396461373230663938383432666433653736636130316362636133646461383534623138353232333963633435613932623364316673637269707478d43832303132303837363361393134323364393365323537393632393836323835303631353764346162353330616130623235356233303838323130333636643661333838346539343363343061313063383532323037353335343866623765313564643230373532663666613032366435646435373337663461356136373735303364326630313762313735323130336533626163333330393865373534383639303531623836646638656539643832656562653734336635313433616462623734343465653937386164343331356236386163667365637265747840653238333765363134643633643164663263633736356130376162646534383330313339313330373463343064663361363466353964386131393931393536636c73746172745f6865696768741a0017f06e6d73776565705f61646472657373782a7462317176686b38726870676e336835383673786479336e387239357a366833336e743532747965766e6774696d656f75741a0017f0d266746f6b656e731a0003d090',
    },
    description: 'Decode swap recovery',
    expected: {
      execution_id: '3356daccaddd39093e2ea11a25e7b46719ee86c5e76577678e7358ce8e55a5e4',
      private_key: 'fc2d30c764199da720f98842fd3e76ca01cbca3dda854b1852239cc45a92b3d1',
      script: '8201208763a91423d93e25796298628506157d4ab530aa0b255b3088210366d6a3884e943c40a10c85220753548fb7e15dd20752f6fa026d5dd5737f4a5a677503d2f017b1752103e3bac33098e754869051b86df8ee9d82eebe743f5143adbb7444ee978ad4315b68ac',
      secret: 'e2837e614d63d1df2cc765a07abde483013913074c40df3a64f59d8a1991956c',
      start_height: 1568878,
      sweep_address: 'tb1qvhk8rhpgn3h586sxdy3n8r95z6h33nt52tyevn',
      timeout: 1568978,
      tokens: 250000,
    },
  },
];

tests.forEach(({args, description, expected}) => {
  return test(description, ({end, equal}) => {
    return decodeLightningLabsRecovery(args, (err, recovery) => {
      equal(err, null, 'No error decoding recovery');

      equal(recovery.execution_id, expected.execution_id, 'Execution id');
      equal(recovery.private_key, expected.private_key, 'Includes private key');
      equal(recovery.script, expected.script, 'Includes swap script');
      equal(recovery.secret, expected.secret, 'Recovery swap secret included');
      equal(recovery.start_height, expected.start_height, 'Swap start height');
      equal(recovery.sweep_address, expected.sweep_address, 'Sweep address');
      equal(recovery.timeout, expected.timeout, 'Includes swap timeout');
      equal(recovery.tokens, expected.tokens, 'Includes swap tokens amount');

      return end();
    });
  });
});
